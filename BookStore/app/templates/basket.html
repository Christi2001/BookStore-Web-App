<!-- basket.html -->

{% extends "base.html" %}
{% block content %}

<br/>
<h1>Basket:</h1>
<br/>
{% if rows > 0 %}
{% for book in books %}
    <div class="row border border-secondary rounded p-3">
        <img class="col-1" src="{{ url_for('static', filename=book.photo) }}">
        <div class="col-3">
            <h3>{{ book.title }}</h3>
            <p>By {{ book.author }}</p>
            <p><strong>Genre:</strong> {{ book.category }}</p>
            <p>In stock: {{ book.stock }}</p>
        </div>
        <div class="col-4">
            <h3><strong>Price per unit:</strong> £{{ book.price }}</h3>
            {% for user_order in user_orders %}
                {% if user_order.bookId == book.id %}
                    {% if user_order.quantity > 1 %}
                        <h3><strong>Total price for {{ user_order.quantity}} items:</strong> 
                        £{{ book.price * user_order.quantity }}</h3>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
        <div class="col-3">
            <div class="row">
                <h2 class="col-2 m-2">Qty:</h2>
                <div class="col-1 m-2">
                    <form action="" method="post" name="minus">
                        {{ form.id(value=book.id, hidden=True) }}
                        {{ form.action(value='minus', hidden=True) }}
                        <input type="submit" class="btn border-secondary" value="-">
                    </form>
                </div>
                {% for user_order in user_orders %}
                    {% if user_order.bookId == book.id %}
                        <div class="col-1 m-2">
                            <h2>{{ user_order.quantity }}</h2>
                        </div>
                    {% endif %}
                {% endfor %}
                <div class="col-2 m-2">
                    <form action="" method="post" name="plus">
                        {{ form.id(value=book.id, hidden=True) }}
                        {{ form.action(value='plus', hidden=True) }}
                        <input type="submit" class="btn border-secondary" value="+">
                    </form>
                </div>
                <div class="col-1 m-2">
                    <form action="" method="post" name="remove all">
                        {{ form.id(value=book.id, hidden=True) }}
                        {{ form.action(value='remove', hidden=True) }}
                        <input type="submit" class="btn btn-danger" value="Remove all!">
                    </form>
                </div>
            </div>
        </div>
    </div>
    <br/>
{% endfor %}
<hr class="border border-secondary">
<div class="row">
    <h2>Total: £{{ total }}</h2>
</div>
{% else %}
    <h4>Your basket is empty!</h4>
{% endif %}
{% endblock %}
